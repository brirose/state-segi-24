---
title: "resistance-assessment"
author: "Shive Lab (B. Baker)"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(terra)
library(sf)
library(here)
library(janitor)

```

-input treatment data
-union to create independent treatment+disturbance history polygons



#Input and clean treatment data


```{r input_data}

#fire history in CBI
fire <- st_read(here("data/spatial_data/outputs/cbi_all/cbi_all.shp")) %>%   #CBI
  st_make_valid()

fire <- vect(fire)  

#full, cleaned treatment layer (will this be the case?)
#currently is just NPS to work out the code
treatment <- vect(here("data/spatial_data/inputs/treatment/NPS_Combined_TrtFile_1966_2023/NPS_Combined_TrtFile_1966_2023.shp")) %>% #add treatment data
  clean_names() %>% 
  project(fire)

#skinny jeans groves
groves <- vect(here("data/spatial_data/inputs/forest/2023_GS_Groves_OTI_public.gdb"), layer = "OGS_Groves_2023_97_public") %>%
  clean_names() %>% 
  project(fire) #uniform crs


```

reminder: do both with buffer and without; need to decide if doing donut or all and subtracting after
```{r buffer}

#buffer groves by 75m
groves_buffered <- buffer(groves, width = 75)

#clip treatment to area(s) of interest
treatment_75clipped <- intersect(treatment, groves_buffered)
treatment_clipped <- intersect(treatment, groves)

#clip fire to area of interest
fire_75clipped <- intersect(fire, groves_buffered)
fire_clipped <- intersect(fire, groves_buffered)

```



```{r union_unbuffered}

#create layer of individual polygons for each fire history
fire_history <- union(fire_clipped)

#create layer of individual polygons for each treatment history
trt_history <- union(treatment_clipped)

#create layer of individual polygons for each fire history/treatment history
resistance_polyons <- union(fire_history, treatment_history)

```



